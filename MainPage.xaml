<?xml version="1.0" encoding="utf-8" ?>
<!--
    MainPage.xaml — Tic-Tac-Toe client UI (MAUI)

    Purpose:
        Main UI for the Tic-Tac-Toe client application.
        The page contains three main logical areas:
          - LobbyView   : initial screen where the user enters server IP and username
          - RoomsView   : list of available game rooms and controls to create/join
          - GameRoomView: active game board and gameplay controls

    Notes:
        - Keep protocol-related logic in the code-behind (MainPage.xaml.cs).
        - XAML contains only visual layout and named controls referenced from code.
-->

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:PiskvorkyClientGUI"
             x:Class="PiskvorkyClientGUI.MainPage"
             BackgroundColor="#111111">

    <!-- ============================================================
         Shared resources and styles
         - Centralize visual styles so controls are consistent.
         - Keep styles lightweight and reusable.
         ============================================================ -->
    <ContentPage.Resources>
        <!-- Primary accent button style with hover effect -->
        <Style x:Key="AccentButton" TargetType="Button">
            <Setter Property="BackgroundColor" Value="#3B82F6" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontAttributes" Value="Bold" />

            <!-- Visual states for hover effect -->
            <Setter Property="VisualStateManager.VisualStateGroups">
                <VisualStateGroupList>
                    <VisualStateGroup>
                        <!-- Default state -->
                        <VisualState Name="Normal">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="#3B82F6" />
                            </VisualState.Setters>
                        </VisualState>
                        <!-- Hover state -->
                        <VisualState Name="PointerOver">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="#2563EB" /> <!-- Darker blue -->
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateGroupList>
            </Setter>
        </Style>

        <!-- Game grid cell style, based on the primary accent -->
        <Style x:Key="GridButton" TargetType="Button" BasedOn="{StaticResource AccentButton}">
            <Setter Property="HeightRequest" Value="100" />
            <Setter Property="WidthRequest" Value="100" />
            <Setter Property="FontSize" Value="48" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="HorizontalOptions" Value="Center" />
            <Setter Property="VerticalOptions" Value="Center" />
        </Style>

        <!-- Generic entry appearance for input fields -->
        <Style TargetType="Entry">
            <Setter Property="BackgroundColor" Value="#222" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="PlaceholderColor" Value="#aaa" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="HeightRequest" Value="50" />
            <Setter Property="Margin" Value="0,6" />
        </Style>
    </ContentPage.Resources>

    <!-- ============================================================
         Layout: root grid holds the three logical views.
         Only one view is visible at a time; visibility is toggled
         from the code-behind in response to server events and user actions.
         ============================================================ -->
    <Grid>

        <!-- ========================================================
             LOBBY VIEW
             - Entry fields for server IP and username
             - Connect action and lightweight status text
             ======================================================== -->
        <Grid x:Name="LobbyView" IsVisible="True" Padding="24">
            <Grid HorizontalOptions="Center" VerticalOptions="Center" WidthRequest="400">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Page title -->
                <Label Text="Lobby"
                       Grid.Row="0"
                       FontSize="36"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="White"
                       Margin="0,0,0,20"/>

                <!-- Server IP input -->
                <Entry x:Name="EntryIP"
                       Grid.Row="1"
                       Placeholder="IP address" />

                <!-- Server Port input -->
                <Entry x:Name="EntryPort"
                       Grid.Row="2"
                       Placeholder="Port"
                       Keyboard="Numeric" />

                <!-- Username input -->
                <Entry x:Name="EntryName"
                       Grid.Row="3"
                       Placeholder="Username" />

                <!-- Connect button -->
                <Button x:Name="ConnectButton"
                        Grid.Row="4"
                        Text="Connect"
                        Style="{StaticResource AccentButton}"
                        CornerRadius="25"
                        Clicked="OnConnectClicked"
                        Margin="0,12" />

                <!-- Status area -->
                <Label x:Name="LabelLobbyStatus"
                       Grid.Row="5"
                       Text=""
                       TextColor="#ccc"
                       FontSize="14"
                       HorizontalOptions="Center"
                       IsVisible="False"
                       Margin="0,10" />
            </Grid>
        </Grid>

        <!-- ========================================================
             ROOMS VIEW
             - Shows available rooms in a CollectionView
             - Controls to refresh, create a room and join the selected room
             ======================================================== -->
        <Grid x:Name="RoomsView" IsVisible="False" Padding="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Back to lobby: returns user to initial screen -->
            <HorizontalStackLayout Grid.Row="0" Padding="0,0,0,10">
                <Button Text="Back to Lobby"
                        Clicked="OnBackToLobbyClicked"
                        Style="{StaticResource AccentButton}"
                        FontSize="14" />
            </HorizontalStackLayout>

            <!-- Title for rooms list -->
            <Label Text="Available Rooms"
                   Grid.Row="1"
                   FontSize="30"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="White"
                   Margin="0,0,0,10" />

            <!-- Actions: refresh, room name input, create -->
            <HorizontalStackLayout Grid.Row="2"
                                   Margin="0,20,0,10"
                                   Spacing="10"
                                   HorizontalOptions="Center">

                <!-- Refresh triggers server list request -->
                <Button Text="Refresh"
                        Style="{StaticResource AccentButton}"
                        FontSize="18"
                        Clicked="OnRefreshRoomsClicked"
                        WidthRequest="120" />

                <!-- Input for creating a room -->
                <Entry x:Name="EntryRoomName"
                       Placeholder="New room name"
                       PlaceholderColor="#888"
                       TextColor="White"
                       BackgroundColor="#2A2A3C"
                       WidthRequest="180" />

                <!-- Create room button -->
                <Button Text="Create"
                        Style="{StaticResource AccentButton}"
                        FontSize="18"
                        Clicked="OnCreateRoomClicked"
                        WidthRequest="120" />
            </HorizontalStackLayout>

            <!-- Rooms list: use CollectionView bound to Rooms collection -->
            <VerticalStackLayout Grid.Row="3"
                                 HorizontalOptions="Center"
                                 WidthRequest="440">

                <CollectionView x:Name="RoomsList"
                                ItemsSource="{Binding Rooms}"
                                SelectionMode="Single"
                                SelectionChanged="OnRoomSelected"
                                BackgroundColor="Transparent">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="local:RoomInfo"> <!-- Zachováno pro bindingy uvnitř šablony -->
                            <Border StrokeThickness="1"
                                    Stroke="#3B82F6"
                                    BackgroundColor="#1E1E2F"
                                    Padding="16"
                                    Margin="6"
                                    StrokeShape="RoundRectangle 12">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="{Binding Name}"
                                           FontSize="22"
                                           TextColor="White"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"
                                           Grid.Column="0" />

                                    <Label Text="{Binding Capacity}"
                                           FontSize="16"
                                           TextColor="#AAAAAA"
                                           VerticalOptions="Center"
                                           HorizontalOptions="End"
                                           Grid.Column="1" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- Join button: sends join request for selected room -->
            <Button Text="Join Selected Room"
                    Style="{StaticResource AccentButton}"
                    FontSize="20"
                    Grid.Row="4"
                    Clicked="OnJoinRoomClicked"
                    HeightRequest="50"
                    WidthRequest="500"
                    Margin="0,10,0,0" />
        </Grid>

        <!-- ========================================================
             GAME ROOM VIEW
             - Active game area with header, status and 3x3 game grid
             - Game grid buttons are named B[row][col], accessed from code-behind
             ======================================================== -->
        <Grid x:Name="GameRoomView" IsVisible="False" Padding="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header: back to rooms + players label -->
            <HorizontalStackLayout Grid.Row="0" Spacing="20" VerticalOptions="Start">
                <Button Text="Back to Rooms"
                        Style="{StaticResource AccentButton}"
                        FontSize="14"
                        Clicked="OnBackToRoomsClicked" />

                <!-- Displays "Player vs Opponent" when a match starts -->
                <Label x:Name="LabelPlayers"
                       FontSize="22"
                       TextColor="White"
                       VerticalOptions="Center" />
            </HorizontalStackLayout>

            <!-- Gameplay status line (turns, info) -->
            <Label x:Name="LabelStatus"
                   Grid.Row="1"
                   Text=""
                   TextColor="#ccc"
                   FontSize="16"
                   HorizontalOptions="Center"
                   Margin="0,10"
                   IsVisible="True" />

            <!-- 3x3 game board -->
            <Grid x:Name="GameGrid"
                  Grid.Row="2"
                  Padding="0"
                  RowSpacing="16"
                  ColumnSpacing="16"
                  HorizontalOptions="Center"
                  VerticalOptions="Center">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Nine interactive cells -->
                <Button x:Name="B00" Grid.Row="0" Grid.Column="0" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
                <Button x:Name="B01" Grid.Row="0" Grid.Column="1" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
                <Button x:Name="B02" Grid.Row="0" Grid.Column="2" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>

                <Button x:Name="B10" Grid.Row="1" Grid.Column="0" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
                <Button x:Name="B11" Grid.Row="1" Grid.Column="1" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
                <Button x:Name="B12" Grid.Row="1" Grid.Column="2" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>

                <Button x:Name="B20" Grid.Row="2" Grid.Column="0" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
                <Button x:Name="B21" Grid.Row="2" Grid.Column="1" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
                <Button x:Name="B22" Grid.Row="2" Grid.Column="2" Style="{StaticResource GridButton}" Clicked="OnCellClicked"/>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>
